# ORACLE Cloud Test Drive #

## Lab 4: Custom Components ##

### STEP 1 CREATE THE CUSTOM COMPONENT API ###

You will be creating a custom API in MCS to act as the custom component for the Bot Dialog Flow.
To simplify this exercise we will use a **“Starter kit”** which contains a predefined component.

This Starter Pack will need to be updated with the name for the API definition you will use. 

**NOTE:** You must be consistent with the naming and use of CASE.

```<API-NAME> = “CafeSupremoTD_{YOUR INITIALS}”```

1. Rename the Starter Kit folder (this represents the node.js package)

Eg.
<table width="50%" border="0">
  <tr>
    <td align="Center"><img src="img/lab4-1-1a.png" width="50%"/></td>
    <td>Rename to =></td>
    <td align="Center"><img src="img/lab4-1-1b.png" width="75%"/></td>
  </tr>
</table>

2. Open the folder and rename the **``{NAME-OF-API}.raml``** and **``{NAME-OF-API}.js``** files in the same way .

3. Open the newly renamed RAML file and edit the name references within the file (at the top of the file)

```
#%RAML 0.8
# This RAML describes the Bots component service REST API contract.
# An MCe custom code API that implements this RAML will be a Bots
component service.
title: <NAME-OF-API>
version: 1.0
baseUri: /mobile/custom/<NAME-OF-API>
```

4. Edit the package.json file and update the API name references

```
{
"name" : "{NAME-OF-API}",
"version" : "1.0.0",
"description" : "Bots OMCe component for TD2",
"main" : "<NAME-OF-API>.js",
"repository": {},
…
```

5. Edit the renamed **``{NAME-OF-API}.js``** file and update the URI reference

```
const apiURL = '/mobile/custom/{NAME-OF-API}/components';
```

6. Login to the MCS instance as the **``TestDrive``** user (the Base URL & current password will be given to you by the facilitator)
<img src="img/lab4-1-6a.png" width="40%"/>

<img src="img/lab4-1-6b.png" width="100%"/>

7. Click on the "Hamburger Menu" at the top of the page 
<img src="img/lab4-1-7a.png"/>

to expose the MCS Function Menu.

<img src="img/lab4-1-7b.png" width="100%"/>

Click on the Mobile Backend Sub Menu (Under Applications).

<img src="img/lab4-1-7c.png" width="100%"/>

8. Click on the ``[+ New Mobile Backend]`` botton to create a new Mobile Backend. Enter the name details based on your ** “{_Initials}”** model.

<img src="img/lab4-1-8.png" width="75%"/>

9. After the Mobile Back End (MBE) is created, Select The **``Settings``** Sub-menu under the newly created Mobile Back End.

<img src="img/lab4-1-9a.png" width="100%"/>

Click the **``Show``** link next to the **Anonymous Key** label to show the Public authentication Token for the MBE.

<img src="img/lab4-1-9b.png" width="100%"/>

Copy the **``Mobile Backend ID``** and the **``Anonymous Key``** to a text editor for use later.

10. Click the **``APIs``** link in the main menu to show the currently defined Custom APIs page (standard API).

<img src="img/lab4-1-10a.png" width="100%"/>

and select ``[New API]`` => ``API`` (**NOT Express API**)

<img src="img/lab4-1-10b.png" width="50%"/>

11. Drag your Renamed RAML file from the Project Folder onto the Dialog Box's Drop area to create the API
definition

<img src="img/lab4-1-11.png" width="75%"/>

<img src="img/lab4-1-11b.png" width="50%"/>

12. Once the API has been created, open the ``General`` if it is not the default (should be on this tab after creating the new API)

<img src="img/lab4-1-12.png" width="100%"/>

Copy the API base URL (under the API Name field) and copy it to a text Editor for future use (similar to MBE and Anonymous Key).

13. Click on the ``EndPoints`` Sub menu and confirm the confirm the creation of the following Resource Endpoints

```
/components
/components/{componentName}
```

eg.
<img src="img/lab4-1-13.png" width="100%"/>

14. Change to the Security Tab and turn OFF the ``Login Required`` security option using the Toggle Switch as shown.

<img src="img/lab4-1-14a.png" width="75%"/>

to

<img src="img/lab4-1-14b.png" width="50%"/>


15. Now Zip up the entire package directory

Eg.
<table width="50%" border="0">
  <tr>
    <td align="Center"><img src="img/lab4-1-15a.png" width="50%"/></td>
    <td>COMPRESS =></td>
    <td align="Center"><img src="img/lab4-1-15b.png" width="75%"/></td>
  </tr>
</table>


16. Return to the Mobile Cloud Service Dashboard.  

With the API page for your API open, Change to the Implementation Tab (2nd from Bottom) 

<img src="img/lab4-1-16a.png" width="100%"/>


and drag the Zip file onto the “Drag-n-Drop” box to create an Runtime implementation in the embedded Node.js engine.

<img src="img/lab4-1-16b.png" width="50%"/>

17. Confirm that the API loaded and was validated successfully.

18. Test the functionality of the Loaded API by clicking the ``[TEST]`` button (top right corner)

<img src="img/lab4-1-18a.png" width="100%"/>

Set the Mobile Back End as the one you created in the first Step. 

<img src="img/lab4-1-18b.png" width="50%"/>

And Press ``[TEST]``

<img src="img/lab4-1-18c.png" width="100%"/>

A successful call to the Service will result in a Status code of **200** as well as a JSON payload containing the metadata block describing the service.



### STEP 2 REGISTER THE CUSTOM COMPONENT WITH THE BOT ##

1. Return to the BOT Designer (Reopen your Bot if it had been closed)

2. Click on the Component Service Icon to access the Custom Component Service Page

<img src="img/lab4-2-2a.png"/>

Click the **``[+ Service ]``** button to define a new Custom Component Service for your Bot.

<img src="img/lab4-2-2b.png" width="75%"/>

3. Fill in the fields with the following details.

<img src="img/lab4-2-3.png" width="75%"/>

```
Name: CafeSupremo_TD_CC_{YOUR INITIALS}
Description: A Custom Component to retrieve menu Information from the Backend.

(*)Mobile Cloud () Other

Backend ID: The Backend ID you copied in Section 1 - Step 9

MetaData URL:  {The API BaseURL copied previously}/components   - the /GET method resource

[X] Use anonymous access

Anonymous Key: The Anonymous Key value copied in Section 1 - Step 9

```

Make sure you select *``Mobile Cloud``** and *``Use Anonymous acces``** options.

Click **``[Create]``** button to register the component service.

4. Once the component service is registered, the components available for use in the dialogue flow will be displayed.  
Click on the ``getFoodMenu`` entry to see the required properties and the supported actions from the component.

<img src="img/lab4-2-4.png" width="75%"/>

5. Return to the Dialog Tab by selecting the Dialog icon.

<img src="img/lab4-2-5.png"/>

Scroll down to find the following YAML fragment

```
# ======================================================
# Show the Appropriate Menu based on selection
# ======================================================
# LAB CHANGE - will be replaced with the Custom Component
#
# showMenu:
#  component: "getFoodMenu"
#  properties:
#    menuSlotVar: ${menuItem.value}
#    menuOption: ${menu.value}
#  transitions:
#    actions:
#      success: "getFoodHeatedOption"
# ==================================================
```

This references the Custom Component you just registered. This component dynamically returns data from the online menu systen removes the need for the various additional menus (as well as introducing a different UI for the Menu when the Bot is accessed in Facebook).

6. Remove the **``"#"``** from the beginning of all lines between **``showMenu => success``** inclusive.

```
# showMenu:
...
#      success: "getFoodHeatedOption"
```

7. Run the Bot in the Dashboard and again in Facebook to see the impact of adding the Custom Component.

## END OF HANDS-ON ##


# Lab Exercise: #
<< [Back to Intelligent Bot Test Drive Home](README.md)
